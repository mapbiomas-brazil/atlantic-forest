var geometry = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-56.05851880152852, -30.04613371617718],
          [-49.20305005152852, -30.841736663987348],
          [-41.46867505152852, -23.861579784474333],
          [-34.17375317652852, -8.163484389272043],
          [-34.26164380152852, -4.801825741437062],
          [-35.66789380152852, -4.582835761516412],
          [-49.07121411402852, -16.947367124654484],
          [-56.10246411402852, -21.01873071079243]]]),
    restinga = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[-49.71509652659208, -29.981748336000535],
           [-49.110878872941186, -29.65767896296548],
           [-47.80358654061317, -27.49682835195526],
           [-47.6168464151344, -25.67947803297374],
           [-45.738261269383166, -24.42549819211931],
           [-41.91515035109426, -23.39104058452276],
           [-40.47598707326645, -21.645608352780645],
           [-39.37738296788238, -19.78580562847774],
           [-38.67426752696853, -16.697815702002345],
           [-38.58637356027154, -14.964512656511282],
           [-38.34467501805771, -13.729896433210655],
           [-37.20210856584854, -11.855139896248712],
           [-36.21334686507915, -10.615976092723534],
           [-35.224583559977184, -9.599323386929987],
           [-34.62033182335309, -8.220952609627659],
           [-34.52144765349295, -7.2193959250650375],
           [-34.89313154040159, -6.165595572617248],
           [-35.03594967741613, -5.769502148040092],
           [-35.33532048791252, -5.1543322284906035],
           [-35.56191165919894, -5.106458357828308],
           [-35.549552589766215, -5.174846344175721],
           [-35.347682812597895, -5.5467458403404954],
           [-35.261167042568545, -5.6506178260853925],
           [-35.20211617937232, -5.6683833674731545],
           [-35.1677845045588, -5.753105050475939],
           [-35.262541507134486, -5.840544877654374],
           [-35.18991442911192, -5.993533308716237],
           [-35.0924126277156, -6.141017452151362],
           [-34.98804426019876, -6.261472605588989],
           [-34.90564980769981, -6.5644332741262685],
           [-34.79853661943341, -6.89447754284801],
           [-34.75322087513685, -7.203558062052527],
           [-34.75734450576095, -7.681516174880935],
           [-34.771960333630226, -7.943122877113888],
           [-34.903797748316485, -8.308823573941451],
           [-35.06310200944344, -8.866908125520206],
           [-35.28676067524797, -9.241207112459978],
           [-35.59163015931926, -9.612400031879437],
           [-35.770155806144544, -9.621876668598869],
           [-35.808607855820306, -9.68009145310518],
           [-35.85667265384348, -9.713932458685374],
           [-35.89237818941962, -9.778897949595518],
           [-35.893751957288565, -9.854675222855816],
           [-35.93220435362827, -9.969660752064641],
           [-36.16428908568856, -10.226538993370932],
           [-36.26591154221676, -10.273835824695347],
           [-36.36992726957931, -10.318102005926312],
           [-36.47808219637983, -10.331257952406721],
           [-36.588631226189, -10.387995625485138],
           [-36.68846988098916, -10.597260915986665],
           [-36.78295133892829, -10.669501835740215],
           [-36.82208828828958, -10.756532368584475],
           [-37.03242022981304, -10.966030572554581],
           [-37.090444535622666, -11.015750503820323],
           [-37.15263646217295, -11.08501654228045],
           [-37.170007068005745, -11.094040163977484],
           [-37.18246950613913, -11.09787779219635],
           [-37.188066352132346, -11.121928954430974],
           [-37.245744844887085, -11.206804977531062],
           [-37.32608125096826, -11.336097255753765],
           [-37.328827385910245, -11.406102792679945],
           [-37.33088630347666, -11.434365739465195],
           [-37.360412530042936, -11.56691733616593],
           [-37.47851532603768, -11.74041672411608],
           [-37.57327129849775, -11.97426623537301],
           [-37.72570500924515, -12.252203834901492],
           [-37.95058042040096, -12.525799146776784],
           [-38.05941443142616, -12.740537165404634],
           [-38.37252041057616, -13.017650814506977],
           [-38.52907295611075, -13.040394879366705],
           [-38.555507100788745, -13.031032524772007],
           [-38.66193356934792, -13.093572140575164],
           [-38.76252703769013, -13.1357008603567],
           [-38.842175682488744, -13.120655269874115],
           [-38.843548806244, -13.131357965596562],
           [-38.8462948177099, -13.141384850574045],
           [-38.865464943484405, -13.152384876056669],
           [-38.910678845828336, -13.194882712712587],
           [-38.96749354326448, -13.20099560223475],
           [-38.97744384708556, -13.24734050344669],
           [-38.99842251391907, -13.296188745692513],
           [-38.9912238690609, -13.364774163672438],
           [-38.96170407873653, -13.386357315660652],
           [-38.90882881975654, -13.356015963138779],
           [-38.917619697141305, -13.380324379590752],
           [-38.918858580179325, -13.408640717194336],
           [-38.91309599536734, -13.411168298389658],
           [-38.9125571065159, -13.414888008286704],
           [-38.91559977815229, -13.429675930700531],
           [-38.91962631850877, -13.452575071818966],
           [-38.92699508194026, -13.475001769027113],
           [-38.93006426024378, -13.561266633395844],
           [-38.91427545096489, -13.576901843204714],
           [-38.905350834182464, -13.60455051413502],
           [-38.93694348376586, -13.645164816146744],
           [-38.94176527884982, -13.662999078935963],
           [-38.94797767570667, -13.681322104260847],
           [-38.96213644419665, -13.681413103840425],
           [-38.98453496186209, -13.681502762152597],
           [-38.99637383529535, -13.68901979269407],
           [-39.02348959473831, -13.716058424872488],
           [-39.027602030073986, -13.749454254726704],
           [-39.01660298165591, -13.774893762685636],
           [-39.00628197640299, -13.824444812426771],
           [-38.99916680450792, -13.84503906815647],
           [-38.9573713919857, -13.87637829038916],
           [-38.94578970174198, -13.900381555660369],
           [-38.953527629502574, -13.927056676836628],
           [-38.94703152249162, -13.951748603515496],
           [-38.936438940479086, -13.951479629431638],
           [-38.93379333511076, -13.977598611663403],
           [-38.95047907647638, -14.018509553318633],
           [-38.95501470142641, -14.055029482617455],
           [-38.96546467425317, -14.082110196186731],
           [-38.97263693233913, -14.108304224243382],
           [-38.97845927277135, -14.129814477929886],
           [-39.015087645290265, -14.160692156707967],
           [-39.03615348628972, -14.218484802150153],
           [-39.033928992621334, -14.25925023045668],
           [-39.0176154722673, -14.24111329815531],
           [-38.986030972277, -14.258573554055817],
           [-39.061903899272274, -14.41922900571965],
           [-39.07392050580702, -14.53922930478703],
           [-39.06612459681437, -14.58083282127026],
           [-39.0260479314337, -14.61711763343086],
           [-38.99736131805206, -14.768744177710346],
           [-39.008346943015425, -14.873622484591973],
           [-38.992554012157974, -14.973475742174744],
           [-38.99095930220611, -15.048262141164066],
           [-38.994948085161, -15.090313376450032],
           [-39.00037532216597, -15.107862469330179],
           [-39.00034299448742, -15.158064730230212],
           [-39.00135662892818, -15.180514470271982],
           [-39.00152007002567, -15.192733156929007],
           [-38.99756349485685, -15.197000000323253],
           [-38.983284397873454, -15.264473099966724],
           [-38.99263916591913, -15.306861165843221],
           [-39.000279078713476, -15.306198373000337],
           [-38.998390674184854, -15.347918193845343],
           [-39.0001091296381, -15.366127229975072],
           [-38.99993983240741, -15.386315480194982],
           [-38.99290181877254, -15.420406167466247],
           [-38.99049660837467, -15.459460568807984],
           [-39.00834928309721, -15.524305468507352],
           [-39.004446843152984, -15.556470552636128],
           [-38.98955581809982, -15.574082195577468],
           [-38.97831174393068, -15.574908898594675],
           [-38.97161450298554, -15.587146014417167],
           [-38.99461689397472, -15.619551102825147],
           [-38.99187044160234, -15.648645115866676],
           [-38.98637810562869, -15.660876975387522],
           [-38.97642151431558, -15.670132521052151],
           [-38.96011265091538, -15.663356184161797],
           [-38.952988934321894, -15.660628861287785],
           [-38.94517952613534, -15.640380325019864],
           [-38.94311837757434, -15.6302966465303],
           [-38.91222111069046, -15.603680096739984],
           [-38.89505463016684, -15.690294979891402],
           [-38.853271520370036, -15.828797264401253],
           [-38.888370229720636, -15.868845378437648],
           [-38.89883032163671, -15.898088678524616],
           [-38.95067894319454, -15.893791304083845],
           [-38.953419840161764, -15.940676950613014],
           [-38.94549395561495, -15.962815190756931],
           [-38.93893906451418, -16.00409768942728],
           [-38.93406692925199, -16.032534628090218],
           [-38.94492413562935, -16.054432389884454],
           [-38.94535197222201, -16.085035695663322],
           [-38.95307692631082, -16.098079222857812],
           [-38.96187250030185, -16.128934598791226],
           [-38.95727937455956, -16.150224978101022],
           [-38.96457361932581, -16.167742693434086],
           [-38.979165489901135, -16.182993853873125],
           [-38.98431885924567, -16.191735379050193],
           [-38.995771146656914, -16.214716325057655],
           [-39.01065961365824, -16.237037133073247],
           [-39.01572036483614, -16.261900716176818],
           [-38.995628683267334, -16.276026677899345],
           [-38.969870876570056, -16.320441459848066],
           [-39.02041926793614, -16.324629765139047],
           [-39.031153016220514, -16.382843792758973],
           [-38.99081825323426, -16.40440106465449],
           [-39.011098221424845, -16.50153202345073],
           [-39.06634225073928, -16.61305420419415],
           [-39.093051300857276, -16.646669128477072],
           [-39.11770605606019, -16.655281662528466],
           [-39.12032743211273, -16.67250762305245],
           [-39.11184004748562, -16.704331593443808],
           [-39.10310727412752, -16.75154206047216],
           [-39.15117160589972, -16.850140154942768],
           [-39.14155904064196, -16.960509148691752],
           [-39.186877500712114, -17.355462981787753],
           [-39.21743266957891, -17.426229084516034],
           [-39.227515063505564, -17.491980551297207],
           [-39.233824327782955, -17.51712910992407],
           [-39.231336556935744, -17.528138372512572],
           [-39.22498582282913, -17.530514596364068],
           [-39.22120940243406, -17.549021793950036],
           [-39.22944901591915, -17.57717053253022],
           [-39.22625895584498, -17.670444162185163],
           [-39.22923287819423, -17.710387640272863],
           [-39.24136196553969, -17.736639777123028],
           [-39.24845578115865, -17.757103118610004],
           [-39.257153176995594, -17.78299919387763],
           [-39.26219038430759, -17.809956282821663],
           [-39.270896758286135, -17.817456810560724],
           [-39.28351171679765, -17.838353576783664],
           [-39.29158204608515, -17.850086002318847],
           [-39.287807873528095, -17.85590794511616],
           [-39.287813133022226, -17.874100389071145],
           [-39.35407289928726, -17.908405049864104],
           [-39.44470795505405, -17.926698060960394],
           [-39.48384584188008, -17.947275554398882],
           [-39.50924082808601, -17.981720056572442],
           [-39.529495206867665, -18.0145348188698],
           [-39.55628537947816, -18.05534989430358],
           [-39.53706041028027, -18.08341629540131],
           [-39.549419196486426, -18.115398842839646],
           [-39.58924443971928, -18.572916148014052],
           [-39.7162750078772, -18.68386294949943],
           [-39.759547167426106, -18.688300017855664],
           [-39.76987246443252, -18.754518169689923],
           [-39.7627084446079, -18.826118125051625],
           [-39.7559339557954, -18.83996048978725],
           [-39.75062644821698, -18.86764769766901],
           [-39.74963867475928, -18.888572950146067],
           [-39.75453682987171, -18.910935004144154],
           [-39.734121247416795, -18.940079181262334],
           [-39.73930527636559, -18.978891390221303],
           [-39.733882972033385, -19.00197787693597],
           [-39.73471665192826, -19.02543821066324],
           [-39.726080849155636, -19.036013325560425],
           [-39.73884920195581, -19.050265556660445],
           [-39.756409907442894, -19.02056336713216],
           [-39.76045501623212, -19.001774726557237],
           [-39.75149086525832, -18.99854937443443],
           [-39.76655745508599, -18.938836569029853],
           [-39.75741987360085, -18.92831009035193],
           [-39.76956744622596, -18.906092391396133],
           [-39.75802570374971, -18.883224236770083],
           [-39.7694847913332, -18.868477598291328],
           [-39.78682803824713, -18.821188820883943],
           [-39.773866480369286, -18.80664707381941],
           [-39.77665645121545, -18.796452863422076],
           [-39.78800690161264, -18.79655670051735],
           [-39.7947108787144, -18.771256109891457],
           [-39.788449225095164, -18.728696639007776],
           [-39.79797965565918, -18.72775190682588],
           [-39.81857865481039, -18.840861697002964],
           [-39.82341265578856, -18.880266329890592],
           [-39.83305613858303, -18.912524063044312],
           [-39.86403548655052, -19.008216499898893],
           [-39.86394809847694, -19.054053995981064],
           [-39.87107185988828, -19.073603772667088],
           [-39.869613466375185, -19.085042858884183],
           [-39.874335027890844, -19.103619601416312],
           [-39.87094422508026, -19.115093770261165],
           [-39.87682317345565, -19.127540899969272],
           [-39.876221852656535, -19.14010914566949],
           [-39.882573042140436, -19.149677311809516],
           [-39.89321735826128, -19.156489457334846],
           [-39.93441516477838, -19.275789701915173],
           [-39.8935609034764, -19.338646823823474],
           [-39.87536530026693, -19.358730089591102],
           [-39.82867466922016, -19.387231148272086],
           [-39.821808439113255, -19.41961260367946],
           [-39.82730151717991, -19.4623462262293],
           [-39.815285566058854, -19.48273786753777],
           [-39.80550371104321, -19.485812982980132],
           [-39.80507514641109, -19.49317567350889],
           [-39.836788654988496, -19.52921673458081],
           [-39.825177841806855, -19.538825048965826],
           [-39.79091037997827, -19.542926757537572],
           [-39.78095470876433, -19.542766343444455],
           [-39.76344529780129, -19.550044422242934],
           [-39.81700238116439, -19.660510431806205],
           [-39.83382667041867, -19.642394621641415],
           [-39.842407485193675, -19.58484052947004],
           [-39.85991646393429, -19.572225401052766],
           [-40.0099446539927, -19.68831154876452],
           [-40.033971465151474, -19.739211789762674],
           [-40.04822420139678, -19.767163409178384],
           [-40.055863020789374, -19.77378549119716],
           [-40.05509050119345, -19.794946178917513],
           [-40.03054363740269, -19.8446846344793],
           [-40.15825651422145, -20.12860424171856],
           [-40.18596560989391, -20.158583515280224],
           [-40.217116577048984, -20.175021726671243],
           [-40.26056394855671, -20.19982608696769],
           [-40.27189335679901, -20.294201294840786],
           [-40.39033645596696, -20.328329654338237],
           [-40.402695764191186, -20.386266320836064],
           [-40.4548794232354, -20.491783780098903],
           [-40.50294331147535, -20.60494127635042],
           [-40.63752207232012, -20.705169752494818],
           [-40.76660778474193, -20.807899400664684],
           [-40.82428436282895, -20.897730470828265],
           [-40.84762964449302, -20.899013385022744],
           [-40.91354569893703, -21.055446172453596],
           [-41.02752552107141, -21.19763167551257],
           [-41.03027197218842, -21.325609629992357],
           [-41.044004448053315, -21.406178517217928],
           [-41.14974470144069, -21.509701867597343],
           [-41.23763268770951, -21.583784463281912],
           [-41.421648028699664, -21.805804526527794],
           [-41.52876130874628, -21.995652033238795],
           [-41.52179193087012, -22.104731236298463],
           [-41.96397762852655, -22.43514350359799],
           [-42.00242839278145, -22.540456279895377],
           [-42.03950594578478, -22.620338909696166],
           [-42.03538581328449, -22.8192092091163],
           [-42.16309785096444, -22.826803828533155],
           [-42.47345190518011, -22.814146893746344],
           [-42.86757391386919, -22.858444195387776],
           [-42.914264811741006, -22.715378663889084],
           [-42.97880773164157, -22.6393538733969],
           [-43.205393771193926, -22.620341734259004],
           [-43.289161616260806, -22.698911306955768],
           [-43.32349195110723, -22.92043617571693],
           [-43.54458478991239, -22.9305551676135],
           [-43.67641686321643, -22.864773707085597],
           [-43.810886743861914, -22.855916531225994],
           [-44.04296550643326, -22.88122366341214],
           [-44.317615223590465, -22.853387832861763],
           [-44.63346177470547, -22.93182460859536],
           [-44.75705315635975, -23.080979674619144],
           [-44.914975481466264, -23.25772891145928],
           [-45.03994045735683, -23.33466826488479],
           [-45.17177148318464, -23.43424466321762],
           [-45.34754623192391, -23.55137157006188],
           [-45.84191403702608, -23.669653993372396],
           [-46.12617551153897, -23.730012646188943],
           [-46.328286330742095, -23.81427433403311],
           [-46.36694058094984, -23.85381947924146],
           [-46.39823623423819, -23.852401572452397],
           [-46.419923995269464, -23.87860864943241],
           [-46.4482003260561, -23.889573873107725],
           [-46.48115801936266, -23.91280056916553],
           [-46.558746389399765, -23.914684193042525],
           [-46.68783111181184, -23.956105172714288],
           [-46.97621130413942, -24.10159932972615],
           [-47.24673873851611, -24.29074437601349],
           [-47.629873370716204, -24.359570940078],
           [-47.7987817262291, -24.42960859247416],
           [-47.83311218085714, -24.489608935539817],
           [-47.856456421904525, -24.5720624601777],
           [-47.89353323963041, -24.641980664478996],
           [-48.066559244857665, -24.88389467749784],
           [-48.39404922012257, -25.100559912379733],
           [-48.738731939853196, -25.209947730215834],
           [-48.88703956432092, -25.414779853919555],
           [-48.88566431567444, -25.569723336300463],
           [-48.847421776126595, -25.894502625263335],
           [-48.916081243177345, -26.09446292141766],
           [-48.984740367943004, -26.31624061962837],
           [-48.97264232071639, -26.406643027698674],
           [-48.9094705407974, -26.611861989232914],
           [-48.87925724840771, -26.764002566772014],
           [-48.81334128650818, -26.798328133285988],
           [-48.811966840188326, -26.89022225960103],
           [-48.79686057861986, -26.93797754704455],
           [-48.680132818011025, -27.123906906397394],
           [-48.68425131224735, -27.217977782110196],
           [-48.68699723349409, -27.260711048262692],
           [-48.76527063489714, -27.352227769810792],
           [-48.78998645996599, -27.538685989029855],
           [-48.752906426033725, -27.73576731161804],
           [-48.74603803247764, -27.902157442766192],
           [-48.82568349786164, -28.073139752689208],
           [-48.94973667613479, -28.32286452912053],
           [-49.06508719925134, -28.418321474313068],
           [-49.15159908461669, -28.55953548894227],
           [-49.407020194770446, -28.611389618158185],
           [-49.58416697886817, -28.65357728834412],
           [-49.718741781532465, -28.80530661122922],
           [-49.893138990581235, -29.043291912758484],
           [-49.938454242909486, -29.13929209889476],
           [-49.98788748670619, -29.34299419959561],
           [-50.096369699936155, -29.5486799166204],
           [-50.12795351821561, -29.583318536449053],
           [-50.149923100955306, -29.71698239266716],
           [-50.06752576099047, -29.92547467147987]]],
         [[[-59.09360579830717, -0.8221435272084644],
           [-59.53305892330717, -30.172065947430667],
           [-58.56626204830717, -31.455244551806224]]]]);

var bioma = "MATAATLANTICA"

var vesion_in = '3'
var version_out = "3"
var prefixo_in = 'MA_col6_p10_v'
var prefixo_out = 'MA_col6_p11_v'

var dirout = 'projects/mapbiomas-workspace/COLECAO6/classificacao-test/'

////*************************************************************
// Do not Change from these lines
////*************************************************************

var palettes = require('users/mapbiomas/modules:Palettes.js');

var class6 = ee.Image(dirout+prefixo_in+vesion_in)
print(class6)

var palettes = require('users/mapbiomas/modules:Palettes.js');
var pal = palettes.get('classification2');
var vis = {
      bands: 'classification_2019',
    'min': 0,
    'max': 45,
    'palette': palettes.get('classification5')
    };
var vis2 = {
    'min': 0,
    'max': 45,
    'palette': palettes.get('classification5')
};
Map.addLayer(class6, vis, 'class4GAP');



var terrain = ee.Image("JAXA/ALOS/AW3D30_V1_1").select("AVE");
Map.addLayer(terrain,{},'relevo',false);


var slope = ee.Terrain.slope(terrain)
Map.addLayer(slope,{},'slope',false);

var plan = terrain.lt(25).clip(restinga).selfMask()
Map.addLayer(plan,{'palette': 'yellow'},'plan',false);

var restinga_abor = class6.select('classification_1985').mask(class6.select('classification_1985').eq(3).and(plan.eq(1)))//
Map.addLayer(restinga_abor,{'palette': '#00ff44'},'restinga arbórea');


var anos = ['1985','1986','1987','1988','1989','1990','1991','1992','1993','1994','1995','1996','1997','1998','1999','2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017','2018','2019','2020'];

for (var i_ano=0;i_ano<anos.length; i_ano++){  
  var ano = anos[i_ano]; 
  
  var col6_ano = class6.select('classification_'+ano)
  var restinga_abor = col6_ano.mask(col6_ano.eq(3).and(plan.eq(1))).remap([3],[49])
  
  var class_out = col6_ano.blend(restinga_abor)
  if (i_ano == 0){ var class_outTotal = class_out }  
  else {class_outTotal = class_outTotal.addBands(class_out); }
}
print(class_outTotal)
Map.addLayer(class_outTotal, vis, 'class6 com restinga');

var years = [
    1985, 1986, 1987, 1988,
    1989, 1990, 1991, 1992,
    1993, 1994, 1995, 1996,
    1997, 1998, 1999, 2000,
    2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008,
    2009, 2010, 2011, 2012,
    2013, 2014, 2015, 2016,
    2017, 2018, 2019, 2020];

// get band names list 
var bandNames = ee.List(
    years.map(
        function (year) {
            return 'classification_' + String(year);
        }
    )
);
// add connected pixels bands
var imageFilledConnected = class_outTotal.addBands(
    class_outTotal
        .connectedPixelCount(100, true)
        .rename(bandNames.map(
            function (band) {
                return ee.String(band).cat('_conn')
            }
        ))
);

Map.addLayer(imageFilledConnected, vis2, 'filtered');

print(imageFilledConnected)

Export.image.toAsset({
    'image': imageFilledConnected,
    'description': prefixo_out+version_out,
    'assetId': dirout+prefixo_out+version_out,
    'pyramidingPolicy': {
        '.default': 'mode'
    },
    'region': geometry,
    'scale': 30,
    'maxPixels': 1e13
});
